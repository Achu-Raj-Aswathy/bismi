<%- include('./partials/header') %>

    <!-- **************** MAIN CONTENT START **************** -->
    <main>
        <!-- Sidebar START -->
        <%- include('./partials/sideBar') %>
            <!-- Sidebar END -->
            <!-- Page content START -->
            <div class="page-content">
                <!-- Top bar START -->
                <%- include('./partials/topBar') %>
                    <!-- Top bar END -->
                    <!-- Page main content START -->

                    <div class="page-content-wrapper p-xxl-4">

                        <!-- Counter START -->
                        <div class="row g-4 mb-4">
                            <!-- Counter item -->
                            <div class="col-lg-4">
                                <div
                                    class="card card-body border border-primary bg-primary bg-opacity-10 border-opacity-25 p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <!-- Digit -->
                                        <div>
                                            <h3 class="mb-0 fw-bold">
                                                <%= flights.length %>
                                            </h3>
                                            <span class="mb-0 h6 fw-light">Total Listings</span>
                                        </div>
                                        <!-- Icon -->
                                        <div class="icon-lg rounded-circle flex-shrink-0 bg-primary text-white mb-0"><i
                                                class="fa-solid fa-hotel fa-fw"></i></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Counter item -->
                            <div class="col-lg-4">
                                <div
                                    class="card card-body border border-warning bg-warning bg-opacity-10 border-opacity-25 p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <!-- Digit -->
                                        <div>
                                            <h3 class="mb-0 fw-bold">56</h3>
                                            <span class="mb-0 h6 fw-light">Booking this month</span>
                                        </div>
                                        <!-- Icon -->
                                        <div class="icon-lg rounded-circle flex-shrink-0 bg-warning text-white mb-0"><i
                                                class="fa-regular fa-calendar-days fa-fw"></i></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Counter item -->
                            <div class="col-lg-4">
                                <div
                                    class="card card-body border border-success bg-success bg-opacity-10 border-opacity-25 p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <!-- Digit -->
                                        <div>
                                            <h3 class="mb-0 fw-bold">$2486.95</h3>
                                            <span class="mb-0 h6 fw-light">Earning this month</span>
                                        </div>
                                        <!-- Icon -->
                                        <div class="icon-lg rounded-circle flex-shrink-0 bg-success text-white mb-0"><i
                                                class="fa-solid fa-money-bill-trend-up fa-fw"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Counter END -->

                        <div class="row g-4 mb-5">
                            <!-- Agent info START -->
                            <div class="col-md-4 col-xxl-3">
                                <div class="card bg-light">
                                    <!-- Dropdown button -->
                                    <div class="dropdown position-absolute top-0 end-0 m-3">
                                        <a href="#" class="btn btn-sm btn-white btn-round lh-lg mb-0" role="button"
                                            id="dropdownShare1" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-three-dots fa-fw"></i>
                                        </a>
                                        <!-- dropdown button -->
                                        <ul class="dropdown-menu dropdown-w-sm dropdown-menu-end min-w-auto shadow rounded"
                                            aria-labelledby="dropdownShare1">
                                            <li><a class="dropdown-item" href="#"><i
                                                        class="bi bi-pencil-square fa-fw me-2"></i>Edit</a></li>
                                            <li><div class="dropdown-item delete-agent-btn"
                                                data-agent-id="<%= agent._id %>"><i
                                                        class="bi bi-trash fa-fw me-2"></i>Remove</div></li>
                                        </ul>
                                    </div>
                                    <!-- Card body -->
                                    <div class="card-body text-center">
                                        <!-- Avatar Image -->
                                        <div class="avatar avatar-xl flex-shrink-0 mb-3">
                                            <img class="avatar-img rounded-circle"
                                                src="<%= agent.image ? agent.image : '/assets/images/avatar/05.jpg' %>"
                                                alt="avatar">
                                        </div>
                                        <!-- Title -->
                                        <h5 class="mb-2">
                                            <%= agent.name %>
                                        </h5>
                                        <!-- <ul class="list-inline small mb-0">
                        <li class="list-inline-item me-0"><i class="fa-solid fa-star text-warning"></i></li>
                        <li class="list-inline-item me-0"><i class="fa-solid fa-star text-warning"></i></li>
                        <li class="list-inline-item me-0"><i class="fa-solid fa-star text-warning"></i></li>
                        <li class="list-inline-item me-0"><i class="fa-solid fa-star text-warning"></i></li>
                        <li class="list-inline-item"><i class="fa-solid fa-star-half-alt text-warning"></i></li>
                    </ul> -->
                                    </div>
                                    <!-- Card footer -->
                                    <div class="card-footer bg-light border-top">
                                        <h6 class="mb-3">Contact Details</h6>
                                        <!-- Email id -->
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="icon-md bg-mode h6 mb-0 rounded-circle flex-shrink-0"><i
                                                    class="bi bi-envelope-fill"></i></div>
                                            <div class="ms-2">
                                                <small>Email id</small>
                                                <h6 class="fw-normal small mb-0"><a href="#">
                                                        <%= agent.email %>
                                                    </a></h6>
                                            </div>
                                        </div>

                                        <!-- Phone -->
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="icon-md bg-mode h6 mb-0 rounded-circle flex-shrink-0"><i
                                                    class="bi bi-telephone-fill"></i></div>
                                            <div class="ms-2">
                                                <small>Phone</small>
                                                <h6 class="fw-normal small mb-0">
                                                    <%= agent.mobile %>
                                                </h6>
                                            </div>
                                        </div>

                                        <!-- Phone -->
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="icon-md bg-mode h6 mb-0 rounded-circle flex-shrink-0"><i
                                                    class="bi bi-geo-alt-fill"></i></div>
                                            <div class="ms-2">
                                                <small>Address</small>
                                                <h6 class="fw-normal small mb-0">
                                                    <%= agent.address %>
                                                    <%= agent.nationality ? ', ' + agent.nationality : '' %>
                                                </h6>
                                            </div>
                                        </div>

                                        <!-- Skype -->
                                        <!-- <div class="d-flex align-items-center">
                        <div class="icon-md bg-mode h6 mb-0 rounded-circle flex-shrink-0"><i class="bi bi-skype"></i></div>
                        <div class="ms-2">
                            <small>Skype</small>
                            <h6 class="fw-normal small mb-0">@Jacqueline56</h6>
                        </div>
                    </div> -->

                                    </div>
                                </div>
                            </div>
                            <!-- Agent info END -->

                            <div class="col-md-8 col-xxl-9">
                                <!-- Personal info START -->
                                <div class="card shadow">
                                    <!-- Card header -->
                                    <div class="card-header border-bottom">
                                        <h5 class="mb-0">Personal Information</h5>
                                    </div>
                                    <!-- Card body -->
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- Information item -->
                                            <div class="col-md-6">
                                                <ul class="list-group list-group-borderless">
                                                    <li class="list-group-item mb-3">
                                                        <span>Full Name:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.name %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>User ID:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.userId %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Mobile Number:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.mobile %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Subscription:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.subscription.subscription %> Plan
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Subscription Date:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= new Date(agent.subscriptionDate).toDateString() %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Expiry Date:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= new Date(agent.expiryDate).toDateString() %>
                                                        </span>
                                                    </li>
                                                </ul>
                                            </div>

                                            <!-- Information item -->
                                            <div class="col-md-6">
                                                <ul class="list-group list-group-borderless">
                                                    <li class="list-group-item mb-3">
                                                        <span>Email ID:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.email %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Gender:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.gender %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Location:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= agent.address %>
                                                            <%= agent.nationality ? ', ' + agent.nationality : '' %>
                                                        </span>
                                                    </li>

                                                    <li class="list-group-item mb-3">
                                                        <span>Joining Date:</span>
                                                        <span class="h6 fw-normal ms-1 mb-0">
                                                            <%= new Date(agent.createdAt).toDateString() %>
                                                        </span>
                                                    </li>
                                                </ul>
                                            </div>

                                            <!-- Information item -->
                                            <!-- <div class="col-12">
                            <ul class="list-group list-group-borderless">
                                <li class="list-group-item">
                                    <span>Description: </span>
                                    <p class="h6 fw-normal mb-0">As it so contrasted oh estimating instrument. Size-like body someone had. Are conduct viewing boy minutes warrant the expense Tolerably behavior may admit daughters offending her ask own? Praise effect wishes to change way and any wanted. Lively use looked latter regard had. Does he it part last in</p>
                                </li>
                            </ul>
                        </div> -->
                                        </div>
                                    </div>
                                </div>
                                <!-- Personal info END -->
                            </div>
                        </div> <!-- Row END -->

                        <!-- Hotel list START -->
                        <div class="row g-4">
                            <!-- Title -->
                            <div class="col-12">
                                <h4 class="mb-0">Inventory List</h4>
                            </div>

                            <% if(flights.length===0) { %>
                                <div class="col-12">
                                    <div class="alert alert-warning mb-0" role="alert">
                                        <i class="bi bi-exclamation-triangle me-2"></i> No listings found.
                                    </div>
                                </div>
                                <% } else { %>
                                    <% flights.forEach((flight)=> { %>
                                        <!-- Hotel item -->
                                        <div class="col-lg-6">
                                            <div class="card shadow p-3">
                                                <div class="row g-4">
                                                    <!-- Card img -->
                                                    <div class="col-sm-3">
                                                        <img src="<%= flight.stops[0].airlineLogo ? flight.stops[0].airlineLogo : '/assets/images/category/hotel/4by3/10.jpg' %>"
                                                            class="rounded-2" alt="Card image">
                                                    </div>

                                                    <!-- Card body -->
                                                    <div class="col-sm-9">
                                                        <div
                                                            class="card-body position-relative d-flex flex-column p-0 h-100">

                                                            <!-- Title -->
                                                            <h5 class="card-title mb-2 me-5"><%= flight.inventoryName %></h5>
                                                            <small><%= flight.from.toUpperCase() %> → <%= flight.to.toUpperCase() %> (<%= flight.stops[0].airlineCode %> - <%= flight.stops[0].flightNumber %> )</small>

                                                            <!-- Price and Button -->
                                                            <div
                                                                class="d-flex justify-content-between align-items-center mt-3 mt-md-auto">
                                                                <!-- Price -->
                                                                <div class="d-flex align-items-center">
                                                                    <h5 class="fw-bold mb-0 me-1">₹ <%= flight.inventoryDates[0].fare.adults %></h5>
                                                                    <span class="mb-0 me-2">/adult</span>
                                                                </div>
                                                                <!-- Button -->
                                                                <a href="/admin/withdrawal/<%= flight._id %>/<%= flight.sellerId %>" 
                                                                class="btn btn-sm btn-primary px-2 mb-0 withdraw-btn" 
                                                                data-flight='<%- JSON.stringify(flight) %>'
                                                                >
                                                                Withdraw
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% }) %>
                                    <!-- Hotel item END -->
                                <% } %>
                        </div>
                        <!-- Hotel list END -->
                    </div>

                    <!-- Page main content END -->
            </div>
            <!-- Page content END -->

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const deleteButtons = document.querySelectorAll(".delete-agent-btn");

                    deleteButtons.forEach(button => {
                        button.addEventListener("click", async function () {
                            const agentId = this.dataset.agentId;

                            // Confirm with the user
                            const confirmed = confirm("Are you sure you want to delete this agent?");
                            if (!confirmed) return;

                            try {
                                const response = await fetch(`/admin/delete-agent/${agentId}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                });

                                const result = await response.json();

                                if (response.ok) {
                                    alert("Agent deleted successfully.");
                                    window.location.href = "/admin/agents"; // Or remove the row from table dynamically
                                } else {
                                    alert("Error: " + result.message || "Failed to delete agent.");
                                }
                            } catch (error) {
                                console.error("Error deleting user:", error);
                                alert("An error occurred while deleting the user.");
                            }
                        });
                    });
                });
            </script>

<!-- <script>
    document.querySelectorAll('.withdraw-btn').forEach(button => {
      button.addEventListener('click', function (e) {
        e.preventDefault();
  
        const flightData = JSON.parse(this.dataset.flight);
        console.log(flightData);

        // Example: Redirect with sellerId + send flight data via POST
        fetch(`/admin/withdrawal/${flightData._id}/${flightData.sellerId}`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
        })
        .then(res => res.json())
        .then(data => {
          console.log("Server Response:", data);
          alert("Withdrawal initiated!");
          // Optionally redirect
          window.location.href = data.redirectUrl;
        })
        .catch(err => {
          console.error("Error:", err);
          alert("An error occurred.");
        });
      });
    });
  </script>
   -->

    </main>
    <!-- **************** MAIN CONTENT END **************** -->

    <%- include('./partials/footer') %>